{% extends 'profileTemplate.html.twig' %}

{% block head %}
    {{ parent() }}
    <meta name="title" content="">
    <meta name="description" content="">
    <link rel="canonical" href="{{ absolute_url(path('experiences_index')) }}">
    <link rel="shortlink" href="{{ absolute_url(path('experiences_index')) }}">
    <meta property="og:title" content="">
    <meta property="og:description" content="">

    <meta property="og:image"
          content="{{ absolute_url(asset('assets/img/favicon/cropped-cropped-logo-trust-and-market-32x32.png')) }}">
    <meta property="og:type" content="website">
    <meta property="og:url" content="{{ absolute_url(path('experiences_index')) }}">
    <meta property="og:locale" content="fr"/>
    <meta property="og:locale:alternate" content="en"/>

    {# Twitter CARD #}
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:creator" content="Kbr Global">
    <meta name="twitter:site" content="@trustandmarket">
    <meta name="twitter:title" content="">
    <meta name="twitter:description" content="">
    <meta name="twitter:image" content="">
    <meta name="twitter:image:alt" content="">
    {# END Twitter Card #}

    <script type="application/ld+json">
	{   
		"@context": "https://schema.org", 
		"@type": "Article",
		"headline": "",
		"alternativeHeadline": "Univers Trust&Market",
		"image": "",
		"author": "Kalide Brassier", 
		"award": "",
		"editor": "Kbr Global", 
		"genre": "Event", 
		"keywords": "", 
		"wordcount": "1120",
		"publisher": {
			"@type": "Organization",
			"name": "Google",
			"logo": {
			"@type": "ImageObject",
			"url": "{{ absolute_url(asset('assets/img/favicon/cropped-cropped-logo-trust-and-market-32x32.png')) }}"
			}
		},
		"url": "{{ absolute_url(path('experiences_index')) }}",
		"mainEntityOfPage": {
			"@type": "WebPage",
			"@id": "{{ absolute_url(path('experiences_index')) }}"
		},
		"datePublished": "",
		"dateCreated": "",
		"dateModified": "",
		"description": "",
		"sameAs": [
			"https://www.facebook.com/trustandmarket",
			"https://twitter.com/trustandmarket",
			"https://www.instagram.com/trustandmarket/",
			"https://www.linkedin.com/company/trustandmarket",
			"https://www.youtube.com/channel/UC-jLvu82KNM6DnFOp2Nvk_A"
		]
	}

    </script>

{% endblock %}

{% block title %}Trust &amp; Market | Expériences | Créer une expérience{% endblock %}

{% block style %}
    {{ parent() }}
    <!-- Gijgo datepicker css -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/gijgo/1.9.13/combined/css/gijgo.min.css"
          integrity="sha512-oCuecFHHGu/Y4zKF8IoSoj5hQq1dLNIiUCwN08ChNW1VoMcjIIirAJT2JmKlYde6DeLN6JRSgntz6EDYDdFhCg=="
          crossorigin="anonymous"/>
    <link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/daterangepicker/daterangepicker.css"/>
    <link rel="stylesheet" href="{{ asset('admin/assets/sweetalert/sweetalert.css') }}">
    <!-- Your custom styles (optional) -->
    <link href="{{ preload(asset('assets/css/style-parametres.css')) }}" rel="stylesheet">
    <link href="{{ absolute_url(asset('assets/css/style.css')) }}" rel="stylesheet">
    {# <link href="{{ asset('assets/css/result.css')}}" rel="stylesheet">
    <link href="{{ asset('assets/css/custome.css') }} " rel="stylesheet"> #}

    <link href="https://www.jqueryscript.net/css/jquerysctipttop.css" rel="stylesheet" type="text/css">
    <link rel="stylesheet" href="{{ asset('assets/css/lc_lightbox.css') }}"/>
    <style>
        .navbar.fixed-top.navbar-expand-lg.navbar-dark.scrolling-navbar.pr-5.pl-5 {
            background-color: black;
        }

        .footer_link {
            display: flex;
            justify-content: space-between;
        }

        .left_link {
            display: flex;
        }

        .footer_link a {
            font-family: "Palanquin Dark", sans-serif;
            color: #000;
            text-decoration: underline;
        }

        .experience_div {
            border-radius: 20px;
            border: 1px solid black;
            padding: 5px 15px;
            margin-bottom: 1rem;
        }

        .list_experiences h1 {
            margin-bottom: 2rem;
            margin-top: 2rem;
            font-size: 30px;
        }

        .list_experiences h2 {
            font-size: 22px;
        }

        .creerExperienceDiv {
            display: flex;
            justify-content: flex-end;
            align-items: center;
        }

        .creerExperienceDiv a {
            background-color: #f17c30;
            color: white;
            padding: 10px;
            border-radius: 10px;
            font-family: "Palanquin Dark", sans-serif;
        }

        .creerExperienceDiv a:hover {
            color: white;
        }

        .mobileDisplayCreateBtn {
            display: none;
            margin-top: 2rem;
            background-color: #f17c30;
            color: white;
            width: fit-content;
            padding: 10px;
            border-radius: 10px;
            font-family: "Palanquin Dark", sans-serif;
        }

        .mobileDisplayCreateBtn:hover {
            color: white;
        }

        .fermerModalApercu {
            background-color: #f17c30 !important;
            color: white;
            padding: 10px;
            border-radius: 10px;
            font-family: "Palanquin Dark", sans-serif;
        }

        .spinner-grow {
            width: 1rem !important;
            height: 1rem !important;
        }

        .apercuExp {
            display: flex;
            align-items: center;
        }

        .inline_choix {
            display: flex;
            align-items: baseline;
        }

        .inline_choix h2 {
            padding: 0;
            margin: 0;
            margin-right: 5px;
        }

        .navbar.fixed-top.navbar-expand-lg.navbar-dark.scrolling-navbar.pr-5.pl-5 {
            background-color: black !important;
        }

        .flex-fill {
            min-height: 50vh;
        }


        @media (max-width: 575.98px) {
            main, .container {
                margin-top: 70px;
            }

            .chat-menu a {
                border-radius: 50%;
                background: #212529;
                width: 15%;
                display: flex !important;
                align-items: center;
                justify-content: center;
                padding: 13px;
            }
        }

        @media (min-width: 576px) and (max-width: 767.98px) {
            main, .container {
                margin-top: 100px;
            }
        }

        @media (max-width: 992px) {
            .navbar {
                background-color: #f17c30 !important;
            }

            .mobileDisplayCreateBtn {
                display: block;
            }

            .webDisplayCreateBtn {
                display: none;
            }
        }
    </style>
    <link href="{{ asset('assets/css/style-profile.css') }} " rel="stylesheet">
{% endblock %}

{% block header %}
    {{ parent() }}
{% endblock %}

{% block navigation %}{% endblock %}

{% block body %}
    <div class="flex-fill container">
        <main class="">
            <div class="container mt-2 pt-4">
                {% include 'menuProfile.html.twig' %}
                <div class="list_experiences">
                    <div class="creerExperienceDiv col-12 my-2">
                        <a href="{{ path('experiences_index') }}" class="webDisplayCreateBtn">Créer une expérience</a>
                    </div>
                    <h2 class="font-weight-bold">Expérience(s) en cours</h2>
                    {% for item in experiences_draft %}
                        <div class="experience_div">
                            <h2>Expérience: {% if item.exp_type_experience == "Musique" %}
                                    {{ item.exp_type_experience }} - {{ item.exp_ville }} - {{ item.exp_univers }}
                                {% else %}
                                    {{ item.exp_type_experience }} - {{ item.exp_lieu_evt }} - {{ item.exp_nom_evt }}
                                {% endif %}</h2>
                            <p>Plus que quelques étapes pour finaliser votre expérience</p>
                            <div class="footer_link">
                                <div class="left_link">
                                    <a href="{{ path('experiences_edit_experience', {'id' : item.id}) }}"
                                       style="margin-right: 1rem;">Continuer</a>
                                    <a class="delete"
                                       href="{{ path('experiences_post_delete_get', {'id' : item.id}) }}">Supprimer</a>
                                </div>
                                <div class="right_link">
                                    <a href="" class="apercuExp" attr-id="{{ item.id }}">Aperçu</a>
                                </div>
                            </div>
                        </div>
                    {% endfor %}
                    <h2 class="font-weight-bold">Expérience(s) validée(s)</h2>
                    {% for item in experiences_publish %}
                        <div class="experience_div">
                            <h2>Expérience: {% if item.exp_type_experience == "Musique" %}
                                    {{ item.exp_type_experience }} - {{ item.exp_ville }} - {{ item.exp_univers }}
                                {% else %}
                                    {{ item.exp_type_experience }} - {{ item.exp_lieu_evt }} - {{ item.exp_nom_evt }}
                                {% endif %}</h2>
                            {# <p>Plus que quelques étapes pour finaliser votre expérience</p> #}
                            <div class="footer_link">
                                <div class="left_link">
                                    <a class="delete"
                                       href="{{ path('experiences_post_delete_get', {'id' : item.id}) }}">Supprimer</a>
                                </div>
                                <div class="right_link">
                                    <a href="" class="apercuExp" attr-id="{{ item.id }}">Aperçu</a>
                                </div>
                            </div>
                        </div>
                    {% endfor %}
                    <a href="{{ path('experiences_index') }}" class="mobileDisplayCreateBtn">Créer une expérience</a>
                </div>
            </div>
        </main>
        <!--Main layout-->
    </div>
    <!-- Modal -->
    <div class="modal fade" id="apercuModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel"
         aria-hidden="true">
        <div class="modal-dialog modal-lg" role="document">
            <div class="modal-content p-3">
                <div class="modal-header">
                    <h5 class="modal-title" id="exampleModalLabel">Expérience <span class="apercuTitre"></span></h5>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <div class="modal-body">
                    <div class="recap_choix">
                        <div class="inline_choix musique_choose">
                            <h4>Ville:&nbsp;</h4>
                            <p style="font-weight: 300;" class="villeValue">Paris 15ème</p>
                        </div>
                        <div class="inline_choix musique_choose">
                            <h4>Style musical:&nbsp;</h4>
                            <p style="font-weight: 300;" class="universValue">Paris 15ème</p>
                        </div>
                        <div class="inline_choix divertissement_choose">
                            <h4>Votre évènement:&nbsp;</h4>
                            <p style="font-weight: 300;" class="nomEvtValue">Paris 15ème</p>
                        </div>
                        <div class="inline_choix divertissement_choose">
                            <h4>Le lieu:&nbsp;</h4>
                            <p style="font-weight: 300;" class="lieuValue">Pop / Folk</p>
                        </div>
                        <div class="inline_choix divertissement_choose">
                            <h4>Nombre de participants:&nbsp;</h4>
                            <p style="font-weight: 300;" class="participantValue">Pop / Folk</p>
                        </div>
                        <div style="margin-top: 2rem;">
                            <h4>Liste de vos besoins:</h4>
                            <div class="besoinValue" style="margin-top: 1.7rem;">
                                <p style="font-weight: 300;margin-bottom: 1rem;">Pop / Folk</p>
                            </div>
                        </div>
                        <div style="margin-top: 3rem;" class="optionDiv">
                            <h4>Les options retenues:</h4>
                            <div class="optionValue" style="margin-top: 1.7rem;">
                                <p style="font-weight: 300;margin-bottom: 1rem;">Pop / Folk</p>
                            </div>
                        </div>
                        <div style="margin-top: 3rem;">
                            <h4>Vos précisions pour une offre sur mesure:</h4>
                            <textarea class="precisionValue field_precisions_2 form-control" name="precisions_2"
                                      id="precisions_2" class="form-control" cols="30" rows="5"
                                      placeholder="Donnez-nous des détails pour nous permettre de personnaliser votre offre : nombre de musiciens, la durée de 'enregistrement studio, nombre de titres pour le mixage..."></textarea>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary fermerModalApercu" data-dismiss="modal">Fermer
                    </button>
                </div>
            </div>
        </div>
    </div>
{% endblock %}


{% block footer %}

    {{ parent() }}

{% endblock %}

{% block javascripts %}
    {{ parent() }}
    <script src="{{ asset('toastr/toastr.min.js') }}"></script>
    <!-- Full background slider jQuery plugin -->
    <script type="text/javascript" src="{{ asset('assets/js/fullclip.min.js') }}"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery-timeago/1.6.7/jquery.timeago.js"></script>
    <script src="{{ asset('assets/js/lc_lightbox.js') }}" type="text/javascript"></script>
    <script src="{{ asset('admin/assets/sweetalert/sweetalert.min.js') }}"></script>
    <!-- SKINS -->
    <link rel="stylesheet" href="{{ asset('assets/css/lc_lightbox_skins_dark.css') }}"/>
    <!-- ASSETS -->
    <script src="{{ asset('assets/js/alloy_finger.min.js') }}" type="text/javascript"></script>
    <script>
    $('.apercuExp').on('click', function (e) {
        e.preventDefault();
        var id = $(this).attr('attr-id');
        $(this).append('<span class="spinner-grow"></span>');
        $.ajax({
            url: "/{{ app.request.locale }}/experience/experience-front/details/" + id,
            type: 'GET',
            success: function (data) {
                //console.log(data);
                data = JSON.parse(data)
                //console.log(data.id);
                $('.spinner-grow').remove();
                if (data.exp_type_experience == "Musique") {
                    $('.optionDiv').fadeIn()
                    $('.apercuTitre').text(data.exp_type_experience + " - " + data.exp_ville + " - " + data.exp_univers)
                    $('.villeValue').text(data.exp_ville)
                    $('.universValue').text(data.exp_univers)
                    $('.musique_choose').fadeIn()
                    $('.divertissement_choose').fadeOut()
                } else {
                    $('.apercuTitre').text(data.exp_type_experience + " - " + data.exp_nom_evt + " - " + data.exp_lieu_evt)
                    $('.nomEvtValue').text(data.exp_nom_evt)
                    $('.lieuValue').text(data.exp_lieu_evt)
                    $('.participantValue').text(+data.exp_participants_evt)
                    $('.musique_choose').fadeOut()
                    $('.optionDiv').fadeOut()
                    $('.divertissement_choose').fadeIn()
                }

                $('.besoinValue').empty();
                if (data.exp_besoins && data.exp_besoins.length > 0) {
                    data.exp_besoins.forEach((element) => {
                        $('.besoinValue').append('<p style="font-weight: 300;margin-bottom: 1rem;">' + element.metaValue + '</p>');
                    })
                }
                $('.optionValue').empty();
                if (data.exp_options && data.exp_options.length > 0) {
                    data.exp_options.forEach((element) => {
                        $('.optionValue').append('<p style="font-weight: 300;margin-bottom: 1rem;">' + element.metaValue + '</p>');
                    })
                }

                $('.precisionValue').val(data.exp_precisions)
                $('#apercuModal').modal('show');
            },
            error: function () {
                $('.spinner-grow').remove();
            }
        });
    })

    var actualStep = 1;
    $(document).on('click', '.list_option', function () {
        $(this).parent().find('.list_option').removeClass('active');
        $(this).addClass('active');
        $('.action_next').addClass('active');
        $('.action_next').removeClass('disabled');
        actualStep = $(this).parent().attr('attr-step');
        if (actualStep == 2) {
            var choixTitle = $(this).find('h2').text();
            $('.step3').attr("attr-title", "Expérience: " + choixTitle)
        }
    })
    $(document).on('change', '.besoins .radio_custom', function () {
        var checkedCheck = 0;
        let that = $(this);
        $('.besoins .radio_custom').each(function () {
            if ($(this).is(":checked")) {
                checkedCheck++
                $('.action_next').addClass('active');
                $('.action_next').removeClass('disabled');
                actualStep = that.parent().parent().parent().parent().parent().parent().parent().attr('attr-step');
            }
        });
        if (checkedCheck == 0) {
            $('.action_next').removeClass('active');
            $('.action_next').addClass('disabled');
        }
    })
    $(document).on('click', '.action_next', function () {
        actualStep = parseInt(actualStep) + 1;
        if (actualStep < 5) {
            $('.steps').fadeOut(300)
            //console.log(actualStep);
            if (actualStep >= 3) {
                $('.prefooter_action').css('margin-top', '35rem')
            } else {
                $('.prefooter_action').css('margin-top', '9rem')
            }
            $('.step' + actualStep).fadeIn()
            $('.experience_create_content h1').text($('.step' + actualStep).attr('attr-title'))
            $('.action_prev').removeClass('hidden');
            if (actualStep > 2) {
                $('.saveAndClose').fadeIn();
            } else {
                $('.saveAndClose').fadeOut(300);
            }
            //console.log($('.step'+actualStep).find('.list_option.active'));
            if ($('.step' + actualStep).find('.list_option.active').length == 0 || actualStep != 4) {
                $(this).removeClass('active');
                $(this).addClass('disabled');
            }
            if (actualStep == 4) {
                $(this).text('Valider')
                $('.action_next').addClass('active');
                $('.action_next').removeClass('disabled');
            } else {
                $(this).text('Suivant')
            }
        } else {
            $('.prefooter_action').remove()
            $('.experience_create_content').remove()
            $('.saveAndClose').remove()
            $('.experience_success_content').fadeIn(500)
        }
    })
    $(document).on('click', '.action_prev', function () {
        actualStep = parseInt(actualStep) - 1;
        if (actualStep == 1) {
            $(this).addClass('hidden');
        }
        if (actualStep > 2) {
            $('.saveAndClose').fadeIn();
        } else {
            $('.saveAndClose').fadeOut(300);
        }
        $('.steps').fadeOut(300)
        if (actualStep >= 3) {
            $('.prefooter_action').css('margin-top', '35rem')
        } else {
            $('.prefooter_action').css('margin-top', '9rem')
        }
        $('.step' + actualStep).fadeIn()
        $('.experience_create_content h1').text($('.step' + actualStep).attr('attr-title'))
        $('.action_next').addClass('active');
        $('.action_next').removeClass('disabled');
        if (actualStep == 4) {
            $(this).text('Valider')
            $('.action_next').addClass('active');
            $('.action_next').removeClass('disabled');
        } else {
            $(this).text('Précédent')
        }
    })

    $(document).ready(function (e) {

        // live handler
        lc_lightbox('.carousel-card', {
            wrap_class: 'lcl_fade_oc',
            gallery: true,
            thumb_attr: 'data-lcl-thumb',
            skin: 'dark',
            radius: 0,
            padding: 0,
            border_w: 0,
            src_attr: 'attr-src',
            max_width: '93%',
            max_height: '93%',
            show_author: false,
            show_title: true,
            show_descr: true,
            thumbs_nav: true,
            tn_hidden: 0,
            txt_hidden: 0,
        });

        main();


        $('.date_input').datepicker({
            dateFormat: 'dd-M-yy',
            minDate: 1,
            closeText: 'Fermer',
            prevText: 'Précédent',
            nextText: 'Suivant',
            currentText: 'Aujourd\'hui',
            monthNames: ['Janvier', 'Février', 'Mars', 'Avril', 'Mai', 'Juin', 'Juillet', 'Août', 'Septembre', 'Octobre', 'Novembre', 'Décembre'],
            monthNamesShort: ['Janv.', 'Févr.', 'Mars', 'Avril', 'Mai', 'Juin', 'Juil.', 'Août', 'Sept.', 'Oct.', 'Nov.', 'Déc.'],
            dayNames: ['Dimanche', 'Lundi', 'Mardi', 'Mercredi', 'Jeudi', 'Vendredi', 'Samedi'],
            dayNamesShort: ['Dim.', 'Lun.', 'Mar.', 'Mer.', 'Jeu.', 'Ven.', 'Sam.'],
            dayNamesMin: ['D', 'L', 'M', 'M', 'J', 'V', 'S'],
            weekHeader: 'Sem.'
        },);

        $('.date_icon').on('click', function () {
            $('.date_input').focus();
        })

        $("#numero_telephone").keyup(function () {
            let phone = $("#numero_telephone").val().replace(/\s|[a-zA-Z]/g, "");
            $("#numero_telephone").val(phone);
        });
    });
    var slideSpeed = 10000;

    var main = function () {
        //Carousel
        setInterval(function () {
            timedDelay()
        }, slideSpeed);
        //arrow-next
        $('.arrow-next').click(function (e) {
            e.preventDefault();

            var currentSlide = $('.active-slide');
            var nextSlide = currentSlide.next();

            var currentDot = $('.active-dot');
            var nextDot = currentDot.next();

            if (nextSlide.length === 0) {
                nextSlide = $('.slide').first();
                nextDot = $('.dot').first();
            }

            currentSlide.fadeOut(600, function () {
                $(this).removeClass('active-slide');
                nextSlide.fadeIn(600).addClass('active-slide');

                currentDot.removeClass('active-dot');
                nextDot.addClass('active-dot');
            });
        });
        //arrow-prev
        $('.arrow-prev').click(function (e) {
            e.preventDefault();

            var currentSlide = $('.active-slide');
            var prevSlide = currentSlide.prev();

            var currentDot = $('.active-dot');
            var prevDot = currentDot.prev();

            if (prevSlide.length === 0) {
                prevSlide = $('.slide').last();
                prevDot = $('.dot').last();
            }

            currentSlide.fadeOut(600, function () {
                $(this).removeClass('active-slide');
                prevSlide.fadeIn(600).addClass('active-slide');

                currentDot.removeClass('active-dot');
                prevDot.addClass('active-dot');
            });
        });
    };

    //timedDelay function
    function timedDelay() {
        var currentSlide = $('.active-slide');
        var nextTimedSlide = currentSlide.next();
        var currentDot = $('.active-dot');
        var nextDot = currentDot.next();
        if (nextTimedSlide.length === 0) {
            nextTimedSlide = $('.slide').first();
            nextDot = $('.dot').first();
        }
        currentSlide.fadeOut(600, function () {
            $(this).removeClass('active-slide');
            nextTimedSlide.fadeIn(600).addClass('active-slide');

            currentDot.removeClass('active-dot');
            nextDot.addClass('active-dot');
        });
    }

    $('#submitForm').on('submit', function (e) { // On emp�che le navigateur de soumettre le formulaire
        e.preventDefault();
        if ($('.numero_telephone').val().match(/^(?:(?:\+|00)33|0)\s*[1-9](?:[\s.-]*\d{2}){4}$/gmi)) {
            toastr.info('{{ 'systeme.requetes.requete-en-cours'|trans }}');
            var $form = $(this);
            var formdata = (window.FormData) ? new FormData($form[0]) : null;
            var data = (formdata !== null) ? formdata : $form.serialize();

            $.ajax({
                url: $form.attr('action'),
                type: $form.attr('method'),
                contentType: false,
                processData: false,
                data: data,
                success: function (reponse) {
                    window.location = "";
                    if (reponse != 0) {
                        toastr.clear();
                        toastr.success('{{ 'systeme.requetes.succes'|trans }}');
                    } else if (reponse == 0) {
                        toastr.clear();
                        toastr.error('{{ 'systeme.requetes.erreur'|trans }}');
                    }

                },
                error: function (reponse) {
                    toastr.clear();
                    toastr.error('{{ 'systeme.requetes.erreur'|trans }}');
                }
            });
        } else {
            toastr.warning('Entrez un numéro de téléphone valide');
        }
        return false;
    });

    $(document).on('click', '.delete', function (e) {
        e.preventDefault();
        var urlPath = $(this).attr('href');
        swal({
            title: "Suppression de l'experience",
            text: "Attention l'expérience sera Supprimée et n'apparaitra plus sur le site",
            type: "info",
            showCancelButton: true,
            confirmButtonClass: "btn-danger",
            confirmButtonText: "Supprimer",
            cancelButtonText: "Annuler",
            closeOnConfirm: false,
            closeOnCancel: false,
            showLoaderOnConfirm: true
        }, function (isConfirm) {
            if (isConfirm) {
                $.ajax({
                    url: urlPath,
                    type: 'GET',
                    success: function (reponse) {
                        if (reponse == 1) {
                            swal("Suppression terminée", "", "success");
                            window.setTimeout(function () {
                                window.location = "";
                            }, 200);
                        }
                    },
                    error: function (response) {
                        swal("Erreur de suppression", "", "error");
                    },
                });
            } else {
                swal.close();
            }
        });
        return false;
    });
    </script>

{% endblock %}
